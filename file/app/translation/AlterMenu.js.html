<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">app/translation/AlterMenu.js | Zeeguu UMR Client API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Cache.js~Cache.html">Cache</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Notifier.js~Notifier.html">Notifier</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/Starer.js~Starer.html">Starer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/UserActivityLogger.js~UserActivityLogger.html">UserActivityLogger</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/zeeguuRequests.js~ZeeguuRequests.html">ZeeguuRequests</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">subscription</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/subscription/ArticleList.js~ArticleList.html">ArticleList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/subscription/FeedSubscriber.js~FeedSubscriber.html">FeedSubscriber</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/subscription/LanguageMenu.js~LanguageMenu.html">LanguageMenu</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/subscription/NoFeedTour.js~NoFeedTour.html">NoFeedTour</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/subscription/StarredArticleList.js~StarredArticleList.html">StarredArticleList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/subscription/SubscriptionList.js~SubscriptionList.html">SubscriptionList</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">translation</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/translation/AlterMenu.js~AlterMenu.html">AlterMenu</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/translation/Speaker.js~Speaker.html">Speaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/translation/Translator.js~Translator.html">Translator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/app/translation/UndoStack.js~UndoStack.html">UndoStack</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">app/translation/AlterMenu.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import $ from &apos;jquery&apos;;
import config from &apos;../config&apos;;
import Notifier from &apos;../Notifier&apos;;
import Translator from &apos;./Translator&apos;;
import ZeeguuRequests from &apos;../zeeguuRequests&apos;;
import UserActivityLogger from &apos;../UserActivityLogger&apos;;

const USER_EVENT_CLOSED_ALTERMENU = &apos;CLOSE ALTERMENU&apos;;
const USER_EVENT_OPENED_ALTERMENU = &apos;OPEN ALTERMENU&apos;;
const MIN_TRANS_COUNT = 2;

/**
 * Class that allows for choosing alternative zeeguu translations from
 * a drop-down alter menu.
 */
export default class AlterMenu {
    /**
     * Initialize the notifier field and the control field for the state of the
     * alter menu (i.e. open or closed).
     */
    constructor() {
        this.menuOpen = false;
        this.notifier = new Notifier();
    }

    /**
     * Create and open the alternative translation menu. 
     * @param {jQuery} $tran - jQuery element encompasing the &lt;tran&gt; tag, 
     * for which to present the alter menu.
     */
    build($tran) {
        // Check how many alternatives there are, if less than 2: abort.
        let countAttr = $tran.attr(config.HTML_ATTRIBUTE_TRANSCOUNT);
        if (!countAttr) return;

        var transCount = parseInt(countAttr);
        if (transCount &lt; MIN_TRANS_COUNT &amp;&amp; $tran.attr(config.HTML_ATTRIBUTE_SUGGESTION) === &apos;&apos;) { // one translation means no alternatives
            this.notifier.notify(config.TEXT_NO_ALTERNATIVES);
        }
        this.construct($tran, transCount);
        this._place($tran);
        $(config.HTML_ID_ALTERMENU).hide();
        this.open();
    };

    /**
     * Add buttons with click listeners that replace the translation and
     * append these to the alter menu. 
     * @param {jQuery} $tran - Reference tag from which the alternative translations are retrieved.
     * @param {int} transCount - Number of present alternative translations. 
     */
    construct($tran, transCount) {
        $(config.HTML_ID_ALTERMENU).empty();
        for (var i = 0; i &lt; transCount; i++) {
            var button = document.createElement(&apos;button&apos;);
            var alternative = $tran.attr(config.HTML_ATTRIBUTE_TRANSLATION + i);
            button.textContent = alternative;
            $(button).addClass(&quot;mdl-button&quot;).addClass(&quot;mdl-js-button&quot;).addClass(&quot;mdl-js-ripple-effect&quot;);
            $(config.HTML_ID_ALTERMENU).append($(button));
            $(button).click({$tran: $tran, alternative: i}, this._swapPrimaryTranslation);
            $(button).click({$tran: $tran, alternative: i}, this._sendSwappedTranslation.bind(this));
        }
        this._appendInputField($tran);
    }

    /**
     * Send the chosen translation from the list of choices to Zeeguu.
     * @param {Object} selectedAlternative - Attribute that determines the selected alternative.  
     */
    _sendSwappedTranslation(selectedAlternative) {
        let $tran = selectedAlternative.data.$tran;
    
        let word = $tran.parent().children(config.HTML_ORIGINAL).text();
        let translation = $tran.attr(config.HTML_ATTRIBUTE_TRANSLATION + selectedAlternative.data.alternative);
        let context = Translator._getContext($tran.parent().get(0));
        let url = window.location.href;
        let title = $(config.HTML_ID_ARTICLE_TITLE).text();
        let selected_from_predefined_choices = true;

        // Launch Zeeguu request to supply translation suggestion.
        ZeeguuRequests.post(config.POST_TRANSLATION_SUGGESTION + &apos;/&apos; + FROM_LANGUAGE + &apos;/&apos; + TO_LANGUAGE,
                           {word: word, context: context, url: url, title: title, translation: translation, 
                            selected_from_predefined_choices: selected_from_predefined_choices});
    }

    /** 
     * Appends the input field for user alternative, to the alter menu.
     * @param {jQuery} $tran - Reference tag from which the suggested translation is retrieved.
     */
    _appendInputField($tran) {
        var input_field = document.createElement(&apos;input&apos;);
        var suggestion  = $tran.attr(config.HTML_ATTRIBUTE_SUGGESTION);
        var value = (suggestion === &apos;&apos; ? config.TEXT_SUGGESTION : suggestion);
        $(input_field).addClass(&apos;mdl-textfield__input&apos;);
        $(input_field).attr(&apos;type&apos;, &apos;text&apos;);
        $(input_field).attr(&apos;id&apos;, config.HTML_ID_USER_ALTERNATIVE);        
        $(input_field).attr(&apos;value&apos;, value);
        $(config.HTML_ID_ALTERMENU).append($(input_field));
    }

    /**
     * Swap the currently set translation (config.HTML_ATTRIBUTE_TRANSLATION 0) with the selected alternative.
     * @param {Object} selectedAlternative - Attribute that determines the selected alternative.  
     */
    _swapPrimaryTranslation(selectedAlternative) {
        var $tran = selectedAlternative.data.$tran;
        var alternative = selectedAlternative.data.alternative;
        var newText = $tran.attr(config.HTML_ATTRIBUTE_TRANSLATION + alternative);
        $tran.attr(config.HTML_ATTRIBUTE_CHOSEN, newText);
    }

    /**
     * Place the alter menu below the supplied zeeguuTag.
     * @param {jQuery} $tran - Reference tag for the placement of the alter menu.
     */
    _place($tran) {
        var position = $tran.position();
        var tagHeight = $tran.outerHeight();
        var tagWidth = $tran.outerWidth();
        var menuWidth = $(config.HTML_ID_ALTERMENU).outerWidth();
        var topScroll = $(&quot;.mdl-layout__content&quot;).scrollTop();
        $tran.append($(config.HTML_ID_ALTERMENU));
        $(config.HTML_ID_ALTERMENU).css({
            position: &quot;absolute&quot;,
            maxWidth: &quot;35%&quot;,
            display: &quot;inline-block&quot;,
            left: position.left + (tagWidth - menuWidth) / 2 + &quot;px&quot;,
            top: position.top + tagHeight + topScroll + &quot;px&quot;
        });        
    }

    /**
     * Update the position of the alter menu.
     */
    reposition() {
        this._place($(config.HTML_ID_ALTERMENU).parent());
    };

    /**
     *  Hide (close) the alter menu. 
     */
    close() {
        let word = $(config.HTML_ID_ALTERMENU).parent().parent().children(config.HTML_ORIGINAL).text();
        UserActivityLogger.log(USER_EVENT_CLOSED_ALTERMENU, word);

        $(config.HTML_ID_ALTERMENU).slideUp(function () {
            $(config.HTML_ID_ALTERMENUCONTAINER).append($(config.HTML_ID_ALTERMENU));
            this.menuOpen = false;
        }.bind(this));
    };

    /**
     *  Open the alter menu. 
     */
    open() {
        let word = $(config.HTML_ID_ALTERMENU).parent().parent().children(config.HTML_ORIGINAL).text();
        UserActivityLogger.log(USER_EVENT_OPENED_ALTERMENU, word);
        
        $(config.HTML_ID_ALTERMENU).slideDown(function () {
            this.menuOpen = true
        }.bind(this));
    };

    /**
     * Check whether the alter menu is an open state.
     * @return {boolean} - True only if the alter menu is open.
     */
    isOpen() {
        return this.menuOpen;
    };
};
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.5.2)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
